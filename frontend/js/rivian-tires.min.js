function rtgColor(e){return getComputedStyle(document.documentElement).getPropertyValue("--rtg-"+e).trim()}const ROWS_PER_PAGE="undefined"!=typeof rtgData&&rtgData.settings&&rtgData.settings.rowsPerPage?rtgData.settings.rowsPerPage:12;let filteredRows=[],allRows=[],currentPage=1,compareList=[],sizeIndex=new Map,brandIndex=new Map,categoryIndex=new Map,priceIndex=[],warrantyIndex=[],weightIndex=[],VALID_SIZES=[],VALID_BRANDS=[],VALID_CATEGORIES=[],tireRatings={},userRatings={},isLoggedIn=!1,activeTooltip=null,searchIndex={brands:new Map,models:new Map,categories:new Map,sizes:new Map,tags:new Map,combined:new Map},suggestionCache=new Map;const CACHE_LIMIT=100;let searchTimeout=null;const SEARCH_DELAY=200,TOOLTIP_DATA={"Load Index":{title:"Load Index",content:"Rivian vehicles require tires with a minimum load index of 116 to safely carry the vehicle's weight. Using a lower load index can affect safety, handling, and durability."},"3PMS Rated":{title:"3PMS Rating",content:"3PMS (Three-Peak Mountain Snowflake) symbol indicates the tire meets winter traction requirements and is rated for severe snow service according to industry standards."},UTQG:{title:"UTQG Rating",content:"UTQG (Uniform Tire Quality Grading) provides standardized ratings for treadwear, temperature resistance (A, B, C), and traction performance (AA, A, B, C) to help compare tire quality."},"3PMS Filter":{title:"3PMS Rating Filter",content:"3PMS (Three-Peak Mountain Snowflake) means the tire meets winter traction requirements and is rated for severe snow service."},"EV Rated Filter":{title:"EV Rated Filter",content:"Filters for tires labeled as EV Rated in their specs or marketing. These are typically optimized for electric vehicles."},"Studded Available Filter":{title:"Studded Available Filter",content:'Filters for tires marked as "Studded Available" — these can be fitted with studs for enhanced traction on ice.'},"Efficiency Score":{title:"Efficiency Score",content:"This Efficiency Score is a calculated score RivianTrackr created to help assist Rivian owners in identifying which tires are likely to be the most range-friendly. It uses a custom formula that factors in weight, tread depth, tire width, load range, speed rating, UTQG, tire category, and winter certification (3PMS). Lighter tires with shallower tread and less aggressive construction typically score higher. <br><br> The score is an estimate only and does not reflect real-world testing. It should not be viewed as a measure of tire quality, safety, or brand reputation."}};"undefined"!=typeof tireRatingAjax&&(isLoggedIn=!0===tireRatingAjax.is_logged_in||"1"===tireRatingAjax.is_logged_in||1===tireRatingAjax.is_logged_in);const ALLOWED_SORT_OPTIONS=["efficiencyGrade","price-asc","price-desc","warranty-desc","weight-asc","weight-desc","alpha","alpha-desc","reviewed","rating-desc","rating-asc"],VALIDATION_PATTERNS={search:/^[a-zA-Z0-9\s\-\/\.\+\*\(\)]*$/,tireId:/^[a-zA-Z0-9\-_]+$/,numeric:/^\d+(\.\d+)?$/,affiliateUrl:/^https:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,}\/[a-zA-Z0-9\-\/_\.%&=?#:+]*$/,imageUrl:/^https:\/\/riviantrackr\.com\/.*\.(jpg|jpeg|png|webp)$/i},NUMERIC_BOUNDS={price:{min:0,max:2e3},warranty:{min:0,max:1e5},weight:{min:0,max:200},rating:{min:1,max:5},page:{min:1,max:1e3}};let domCache={},isRendering=!1,pendingRender=!1,lastFilterState=null,renderAnimationFrame=null,cardCache=new Map,cardContainer=null,eventDelegationSetup=!1,ratingRequestQueue=[],ratingRequestTimeout=null;function escapeHTML(e){return"string"!=typeof e?"":String(e).replace(/[&<>"'\/]/g,function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}[e]})}function safeString(e,t=200){if("string"!=typeof e)return"";const n=String(e).trim();return n.length>t?n.substring(0,t):n}function sanitizeInput(e,t=null){if("string"!=typeof e)return"";let n;return n=t===VALIDATION_PATTERNS.search?e.replace(/[<>\"'&\\]/g,"").trim():e.replace(/[<>\"'&\/\\]/g,"").trim(),t&&!t.test(n)?(console.warn("Input failed pattern validation:",n),""):n.length>100?n.substring(0,100):n}function safeImageURL(e){if("string"!=typeof e||!e.trim())return"";const t=e.trim();if(!VALIDATION_PATTERNS.imageUrl.test(t))return t.match(/\.(jpg|jpeg|png|webp|gif)$/i)&&console.warn("Image URL failed validation:",t),"";try{const e=new URL(t);return"https:"!==e.protocol||("riviantrackr.com"!==e.hostname||e.pathname.includes("..")||e.pathname.includes("//"))?"":t}catch(e){return t.match(/\.(jpg|jpeg|png|webp|gif)$/i)&&console.warn("Invalid image URL:",t),""}}function safeLinkURL(e){if("string"!=typeof e||!e.trim())return"";const t=e.trim();if(!VALIDATION_PATTERNS.affiliateUrl.test(t))return t.startsWith("http")&&console.warn("Affiliate link URL failed validation:",t),"";try{const e=new URL(t);if("https:"!==e.protocol)return"";const n=["riviantrackr.com","tirerack.com","discounttire.com","amazon.com","amzn.to","costco.com","walmart.com","goodyear.com","bridgestonetire.com","michelinman.com","continental-tires.com","pirelli.com","sumitomotire.com","yokohamatire.com","coopertire.com","bfgoodrichtires.com","firestone.com","generaltire.com","hankooktire.com","kumhotire.com","nexentire.com","toyo.com","falkentire.com","nittotire.com","autozone.com","pepboys.com","ntb.com","simpletire.com","prioritytire.com","anrdoezrs.net","dpbolvw.net","jdoqocy.com","kqzyfj.com","tkqlhce.com","commission-junction.com","cj.com","linksynergy.com","click.linksynergy.com","shareasale.com","avantlink.com","impact.com","partnerize.com"],r=e.hostname.toLowerCase();return n.some(e=>r===e||r.endsWith("."+e))?e.pathname.includes("..")?"":t:(console.warn("Affiliate link domain not in allowlist:",r),"")}catch(e){return console.warn("Invalid affiliate link URL:",t),""}}function safeBundleLinkURL(e){if("string"!=typeof e||!e.trim())return"";const t=e.trim();if(!/^https:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,}\/[a-zA-Z0-9\-\/_\.%&=?#:+]*$/.test(t))return"";try{const e=new URL(t);if("https:"!==e.protocol)return"";const n=["riviantrackr.com","evsportline.com","www.evsportline.com","tsportline.com","www.tsportline.com","tirerack.com","www.tirerack.com","discounttire.com","www.discounttire.com","costco.com","www.costco.com","walmart.com","www.walmart.com","amazon.com","www.amazon.com","amzn.to"],r=e.hostname.toLowerCase();return n.some(e=>r===e||r.endsWith("."+e))?e.pathname.includes("..")?"":t:(console.warn("Bundle link domain not in allowlist:",r),"")}catch(e){return console.warn("Invalid bundle link URL:",t),""}}function validateNumeric(e,t,n=0){if("string"==typeof e){if(!VALIDATION_PATTERNS.numeric.test(e))return n;e=parseFloat(e)}return"number"!=typeof e||isNaN(e)?n:e<t.min||e>t.max?(console.warn(`Numeric value ${e} outside bounds [${t.min}, ${t.max}]`),Math.max(t.min,Math.min(t.max,e))):e}function getDOMElement(e){return domCache[e]||(domCache[e]=document.getElementById(e)),domCache[e]}function debounce(e,t){let n;return function(...r){clearTimeout(n),n=setTimeout(()=>e.apply(this,r),t)}}function throttledRender(){isRendering?pendingRender=!0:(renderAnimationFrame&&cancelAnimationFrame(renderAnimationFrame),renderAnimationFrame=requestAnimationFrame(()=>{isRendering=!0,render(),setTimeout(()=>{isRendering=!1,renderAnimationFrame=null,pendingRender&&(pendingRender=!1,throttledRender())},16)}))}function buildSearchIndex(){console.time("Building search index"),Object.values(searchIndex).forEach(e=>e.clear()),allRows.forEach((e,t)=>{const[n,r,a,i,o,s,c,l,d,u,g,m,p,f,h,y,v,S]=e,x=safeString(i).toLowerCase().trim(),E=safeString(o).toLowerCase().trim(),w=safeString(s).toLowerCase().trim(),C=safeString(r).toLowerCase().trim(),b=safeString(S).toLowerCase().trim();if(x){searchIndex.brands.has(x)||searchIndex.brands.set(x,{display:safeString(i).trim(),count:0,rows:[]});const e=searchIndex.brands.get(x);e.count++,e.rows.push(t)}if(E){const e=`${x} ${E}`;searchIndex.models.has(e)||searchIndex.models.set(e,{display:`${safeString(i).trim()} ${safeString(o).trim()}`,brand:safeString(i).trim(),model:safeString(o).trim(),count:0,rows:[]});const n=searchIndex.models.get(e);n.count++,n.rows.push(t)}if(w){searchIndex.categories.has(w)||searchIndex.categories.set(w,{display:safeString(s).trim(),count:0,rows:[]});const e=searchIndex.categories.get(w);e.count++,e.rows.push(t)}if(C){searchIndex.sizes.has(C)||searchIndex.sizes.set(C,{display:safeString(r).trim(),count:0,rows:[]});const e=searchIndex.sizes.get(C);e.count++,e.rows.push(t)}if(b){b.split(/[,|]/).map(e=>e.trim()).filter(Boolean).forEach(e=>{searchIndex.tags.has(e)||searchIndex.tags.set(e,{display:e,count:0,rows:[]});const n=searchIndex.tags.get(e);n.count++,n.rows.includes(t)||n.rows.push(t)})}[x,E,w,C,...b.split(/[,|]/).map(e=>e.trim()).filter(Boolean)].filter(Boolean).forEach(e=>{e.length>=2&&(searchIndex.combined.has(e)||searchIndex.combined.set(e,new Set),searchIndex.combined.get(e).add(t))})})}function fuzzyMatch(e,t,n=.7){if(0===e.length)return 1;if(0===t.length)return 0;const r=e.toLowerCase(),a=t.toLowerCase();if(a.includes(r))return r===a?1:.9;const i=Array(e.length+1).fill(null).map(()=>Array(t.length+1).fill(null));for(let t=0;t<=e.length;t++)i[t][0]=t;for(let e=0;e<=t.length;e++)i[0][e]=e;for(let n=1;n<=e.length;n++)for(let e=1;e<=t.length;e++){const t=r[n-1]===a[e-1]?0:1;i[n][e]=Math.min(i[n-1][e]+1,i[n][e-1]+1,i[n-1][e-1]+t)}const o=1-i[e.length][t.length]/Math.max(e.length,t.length);return o>=n?o:0}function generateSearchSuggestions(e,t=8){if(!e||e.length<1)return[];const n=`${e.toLowerCase()}_${t}`;if(suggestionCache.has(n))return suggestionCache.get(n);const r=e.toLowerCase().trim(),a=[],i=new Set,o=(e,n,o=1)=>{const s=`${n}:${e.display.toLowerCase()}`;!i.has(s)&&a.length<t&&(i.add(s),a.push({...e,type:n,score:o,query:r}))},s=(e,t)=>{const n=e.toLowerCase(),r=t.toLowerCase();if(n===r)return{match:!0,score:1};if(n.startsWith(r))return{match:!0,score:.9};const a=n.split(/[\s\-\/\+\(\)]+/),i=r.split(/[\s\-\/\+\(\)]+/);if(a.some(e=>e.startsWith(r)))return{match:!0,score:.8};if(i.every(e=>e.length>=2&&a.some(t=>t.startsWith(e)))&&i.length>1)return{match:!0,score:.7};if(1===r.length)return{match:!1,score:0};if(r.length<=3){const e=a.some(e=>e.startsWith(r));return{match:e,score:e?.6:0}}return n.includes(r)&&r.length>=4?{match:!0,score:.5}:{match:!1,score:0}};if(searchIndex.brands.forEach((e,t)=>{const n=s(e.display,r);n.match&&o(e,"brand",n.score)}),searchIndex.models.forEach((e,t)=>{const n=s(e.brand,r),a=s(e.model,r),i=s(e.display,r),c=Math.max(n.score,a.score,i.score);c>0&&o(e,"model",.95*c)}),searchIndex.categories.forEach((e,t)=>{const n=s(e.display,r);n.match&&o(e,"category",.9*n.score)}),searchIndex.sizes.forEach((e,t)=>{const n=s(e.display,r);n.match&&o(e,"size",.85*n.score)}),a.length<3&&r.length>=4){const e=[];searchIndex.combined.forEach((t,n)=>{if(n.length>=r.length){const t=fuzzyMatch(r,n,.8);if(t>.8&&e.length<10){const r=searchIndex.brands.get(n),a=searchIndex.categories.get(n);r?e.push({item:r,type:"brand",score:.6*t}):a&&e.push({item:a,type:"category",score:.5*t})}}}),e.sort((e,t)=>t.score-e.score).slice(0,t-a.length).forEach(e=>o(e.item,e.type,e.score))}const c=a.sort((e,t)=>Math.abs(e.score-t.score)>.05?t.score-e.score:t.count-e.count).slice(0,t);if(suggestionCache.size>=100){const e=suggestionCache.keys().next().value;suggestionCache.delete(e)}return suggestionCache.set(n,c),c}function showSearchSuggestions(e,t){const n=document.querySelector(".search-suggestions-dropdown");if(n&&n.remove(),!e.length)return;const r=document.createElement("div");r.className="search-suggestions-dropdown",r.style.cssText=`\n    position: absolute;\n    top: 100%;\n    left: 0;\n    right: 0;\n    background: ${rtgColor("bg-primary")};\n    border: 1px solid #475569;\n    border-radius: 0 0 8px 8px;\n    border-top: none;\n    max-height: 300px;\n    overflow-y: auto;\n    z-index: 1000;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n  `,e.forEach((n,a)=>{const i=document.createElement("div");i.className="search-suggestion-item",i.style.cssText=`\n      padding: 12px 16px;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      transition: background-color 0.2s ease;\n      border-bottom: 1px solid ${rtgColor("border")};\n    `,a===e.length-1&&(i.style.borderBottom="none");const o=document.createElement("div");o.style.cssText="display: flex; align-items: center; gap: 12px; flex: 1;";const s=document.createElement("i");s.className=(e=>{switch(e){case"brand":return"fa-solid fa-building";case"model":return"fa-solid fa-circle";case"category":return"fa-solid fa-tags";case"size":return"fa-solid fa-ruler";default:return"fa-solid fa-search"}})(n.type),s.style.cssText=`color: ${rtgColor("text-muted")}; font-size: 14px; width: 16px;`;const c=document.createElement("div");c.style.cssText=`color: ${rtgColor("text-light")}; font-weight: 500;`,c.textContent=n.display,o.appendChild(s),o.appendChild(c);const l=document.createElement("div");l.style.cssText="display: flex; align-items: center; gap: 8px;";const d=document.createElement("span");d.style.cssText=`\n      background: ${rtgColor("bg-input")};\n      color: #9ca3af;\n      font-size: 11px;\n      padding: 2px 6px;\n      border-radius: 4px;\n      text-transform: uppercase;\n      font-weight: 600;\n    `,d.textContent=n.type;const u=document.createElement("span");u.style.cssText="color: #6b7280; font-size: 12px;",u.textContent=`${n.count} tire${1!==n.count?"s":""}`,l.appendChild(d),l.appendChild(u),i.appendChild(o),i.appendChild(l),i.addEventListener("mouseenter",()=>{i.style.backgroundColor=rtgColor("bg-input")}),i.addEventListener("mouseleave",()=>{i.style.backgroundColor="transparent"}),i.addEventListener("click",()=>{applySuggestion(n,t),hideSearchSuggestions()}),r.appendChild(i)});const a=t.closest(".search-container");a&&(a.style.position="relative",a.appendChild(r))}function applySuggestion(e,t){switch(e.type){case"brand":const n=getDOMElement("filterBrand");n&&(n.value=e.display),t.value="";break;case"category":const r=getDOMElement("filterCategory");r&&(r.value=e.display),t.value="";break;case"size":const a=getDOMElement("filterSize");a&&(a.value=e.display),t.value="";break;case"model":const i=getDOMElement("filterBrand");i&&e.brand&&(i.value=e.brand),t.value=e.model}filterAndRender()}function hideSearchSuggestions(){const e=document.querySelector(".search-suggestions-dropdown");e&&(e.style.opacity="0",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},150))}function handleSmartSearch(e){clearTimeout(searchTimeout);const t=e.value.trim();0!==t.length?searchTimeout=setTimeout(()=>{showSearchSuggestions(generateSearchSuggestions(t),e)},200):hideSearchSuggestions()}function initializeSmartSearch(){const e=getDOMElement("searchInput");if(!e)return;buildSearchIndex();const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),domCache.searchInput=t,t.addEventListener("input",e=>{handleSmartSearch(e.target),debounce(filterAndRender,500)()}),t.addEventListener("focus",e=>{e.target.value.trim()&&handleSmartSearch(e.target)}),document.addEventListener("click",e=>{e.target.closest(".search-container")||hideSearchSuggestions()}),t.addEventListener("keydown",e=>{const t=document.querySelector(".search-suggestions-dropdown");if(!t)return;const n=t.querySelectorAll(".search-suggestion-item"),r=t.querySelector(".search-suggestion-item.active");let a=r?Array.from(n).indexOf(r):-1;switch(e.key){case"ArrowDown":e.preventDefault(),a=Math.min(a+1,n.length-1);break;case"ArrowUp":e.preventDefault(),a=Math.max(a-1,-1);break;case"Enter":return e.preventDefault(),void(a>=0&&n[a].click());case"Escape":return void hideSearchSuggestions();default:return}n.forEach((e,t)=>{t===a?(e.classList.add("active"),e.style.backgroundColor=rtgColor("accent"),e.style.color="#1a1a1a"):(e.classList.remove("active"),e.style.backgroundColor="transparent",e.style.color=rtgColor("text-light"))})}),document.addEventListener("filtersReset",()=>{const e=document.querySelector("#searchInput");e&&(e.value="",hideSearchSuggestions())}),document.addEventListener("click",e=>{e.target.textContent&&e.target.textContent.includes("Clear All")&&setTimeout(()=>{const e=document.querySelector("#searchInput");e&&(e.value="",hideSearchSuggestions())},50)})}function isPreciseMatch(e,t){const n=e.toLowerCase().trim(),r=t.toLowerCase().trim();if(!r)return!0;if(n===r)return!0;if(n.startsWith(r))return!0;const a=n.split(/\s+/);return!!r.split(/\s+/).every(e=>a.some(t=>t===e||(!!(e.length>=3&&t.startsWith(e))||!(!e.includes("/")&&!e.includes("-"))&&(t===e||t.startsWith(e)))))||!!(r.length>=4&&n.includes(r))}function createInfoTooltip(e,t){const n=document.createElement("div");n.style.cssText="display: flex; align-items: center; gap: 6px;";const r=document.createElement("span");r.className="tire-card-spec-label",r.textContent=e;const a=document.createElement("button");return a.innerHTML='<i class="fa-solid fa-circle-info"></i>',a.className="info-tooltip-trigger",a.dataset.tooltipKey=t,a.style.cssText="\n    background: none;\n    border: none;\n    color: #94a3b8;\n    font-size: 14px;\n    cursor: pointer;\n    padding: 2px;\n    border-radius: 50%;\n    width: 20px;\n    height: 20px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n  ",a.addEventListener("mouseenter",()=>{a.style.color=rtgColor("accent"),a.style.backgroundColor=`color-mix(in srgb, ${rtgColor("accent")} 10%, transparent)`}),a.addEventListener("mouseleave",()=>{a.style.color=rtgColor("text-muted"),a.style.backgroundColor="transparent"}),n.appendChild(r),n.appendChild(a),n}function createFilterTooltip(e,t){const n=document.createElement("div");n.style.cssText="display: flex; align-items: center; gap: 6px;";const r=document.createElement("span");r.textContent=e;const a=document.createElement("button");return a.innerHTML='<i class="fa-solid fa-circle-info"></i>',a.className="info-tooltip-trigger",a.dataset.tooltipKey=t,a.style.cssText="\n    background: none;\n    border: none;\n    color: #94a3b8;\n    font-size: 14px;\n    cursor: pointer;\n    padding: 2px;\n    border-radius: 50%;\n    width: 20px;\n    height: 20px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n  ",a.addEventListener("mouseenter",()=>{a.style.color=rtgColor("accent"),a.style.backgroundColor=`color-mix(in srgb, ${rtgColor("accent")} 10%, transparent)`}),a.addEventListener("mouseleave",()=>{a.style.color=rtgColor("text-muted"),a.style.backgroundColor="transparent"}),n.appendChild(r),n.appendChild(a),n}function showTooltipModal(e,t){closeTooltipModal();const n=TOOLTIP_DATA[e];if(!n)return;const r=document.createElement("div");r.className="tooltip-modal-overlay",r.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.5);\n    z-index: 10000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 20px;\n    animation: fadeIn 0.2s ease;\n    backdrop-filter: blur(2px);\n  ";const a=document.createElement("div");a.className="tooltip-modal",a.style.cssText=`\n    background: ${rtgColor("bg-primary")};\n    border-radius: 12px;\n    padding: 20px;\n    max-width: 400px;\n    width: 100%;\n    color: ${rtgColor("text-light")};\n    border: 1px solid #475569;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    animation: slideUp 0.2s ease;\n    position: relative;\n  `;const i=document.createElement("h3");i.textContent=n.title,i.style.cssText=`\n    margin: 0 0 12px 0;\n    font-size: 18px;\n    font-weight: 700;\n    color: ${rtgColor("accent")};\n  `;const o=document.createElement("p");o.innerHTML=n.content,o.style.cssText="\n    margin: 0 0 16px 0;\n    line-height: 1.5;\n    font-size: 14px;\n    color: #e2e8f0;\n  ";const s=document.createElement("button");s.innerHTML='<i class="fa-solid fa-xmark"></i>',s.style.cssText="\n    position: absolute;\n    top: 16px;\n    right: 16px;\n    background: none;\n    border: none;\n    color: #94a3b8;\n    font-size: 16px;\n    cursor: pointer;\n    padding: 4px;\n    border-radius: 4px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n  ",s.addEventListener("mouseenter",()=>{s.style.color=rtgColor("text-light"),s.style.backgroundColor="rgba(148, 163, 184, 0.2)"}),s.addEventListener("mouseleave",()=>{s.style.color=rtgColor("text-muted"),s.style.backgroundColor="transparent"});const c=document.createElement("button");c.textContent="Got it",c.style.cssText=`\n    background: ${rtgColor("accent")};\n    color: #1a1a1a;\n    border: none;\n    padding: 8px 16px;\n    border-radius: 6px;\n    font-weight: 600;\n    cursor: pointer;\n    font-size: 14px;\n    transition: background-color 0.2s ease;\n    width: 100%;\n  `,c.addEventListener("mouseenter",()=>{c.style.backgroundColor=rtgColor("accent-hover")}),c.addEventListener("mouseleave",()=>{c.style.backgroundColor=rtgColor("accent")});const l=()=>closeTooltipModal();s.addEventListener("click",l),c.addEventListener("click",l),r.addEventListener("click",e=>{e.target===r&&l()});const d=e=>{"Escape"===e.key&&(l(),document.removeEventListener("keydown",d))};document.addEventListener("keydown",d),a.appendChild(i),a.appendChild(o),a.appendChild(s),a.appendChild(c),r.appendChild(a),document.body.appendChild(r),activeTooltip=r,document.body.style.overflow="hidden",c.focus()}function closeTooltipModal(){activeTooltip&&(activeTooltip.style.animation="fadeOut 0.2s ease",setTimeout(()=>{activeTooltip&&activeTooltip.parentNode&&activeTooltip.parentNode.removeChild(activeTooltip),activeTooltip=null,document.body.style.overflow=""},200))}function buildFilterIndexes(){sizeIndex.clear(),brandIndex.clear(),categoryIndex.clear(),priceIndex.length=0,warrantyIndex.length=0,weightIndex.length=0,allRows.forEach((e,t)=>{const[n,r,a,i,o,s,c,l,d]=e,u=safeString(r).toLowerCase();u&&(sizeIndex.has(u)||sizeIndex.set(u,[]),sizeIndex.get(u).push(t));const g=safeString(i).toLowerCase();g&&(brandIndex.has(g)||brandIndex.set(g,[]),brandIndex.get(g).push(t));const m=safeString(s).toLowerCase();m&&(categoryIndex.has(m)||categoryIndex.set(m,[]),categoryIndex.get(m).push(t));const p=validateNumeric(c,NUMERIC_BOUNDS.price),f=validateNumeric(l,NUMERIC_BOUNDS.warranty),h=validateNumeric(d,NUMERIC_BOUNDS.weight);priceIndex.push({index:t,value:p}),warrantyIndex.push({index:t,value:f}),weightIndex.push({index:t,value:h})}),priceIndex.sort((e,t)=>e.value-t.value),warrantyIndex.sort((e,t)=>e.value-t.value),weightIndex.sort((e,t)=>e.value-t.value)}function binarySearchMax(e,t){let n=0,r=e.length-1;for(;n<=r;){const a=Math.floor((n+r)/2);e[a].value<=t?n=a+1:r=a-1}return new Set(e.slice(0,r+1).map(e=>e.index))}function validateAndSanitizeCSVRow(e){if(!Array.isArray(e))return null;if(e.length<23)return null;const t=new Array(e.length);for(let n=0;n<e.length;n++){const r=e[n];"string"==typeof r?(t[n]=r.replace(/[<>\"'&]/g,"").trim(),t[n].length>500&&(t[n]=t[n].substring(0,500))):t[n]="number"==typeof r?6===n?validateNumeric(r,NUMERIC_BOUNDS.price):7===n?validateNumeric(r,NUMERIC_BOUNDS.warranty):8===n?validateNumeric(r,NUMERIC_BOUNDS.weight):"number"!=typeof r||isNaN(r)?0:r:""}return t[0]&&VALIDATION_PATTERNS.tireId.test(t[0])?t:null}function updateSliderBackground(e){const t=parseFloat(e.min),n=parseFloat(e.max),r=(parseFloat(e.value)-t)/(n-t)*100;e.style.setProperty("--percent",`${r}%`)}function initializeRatingSystem(){"undefined"!=typeof tireRatingAjax&&(isLoggedIn=!0===tireRatingAjax.is_logged_in||"1"===tireRatingAjax.is_logged_in||1===tireRatingAjax.is_logged_in)}function loadTireRatings(e){if(!e.length)return Promise.resolve();const t=e.filter(e=>"string"==typeof e&&VALIDATION_PATTERNS.tireId.test(e)&&e.length<=50);return t.length?(ratingRequestQueue.push(...t),ratingRequestTimeout&&clearTimeout(ratingRequestTimeout),new Promise(e=>{ratingRequestTimeout=setTimeout(()=>{const t=[...new Set(ratingRequestQueue)];if(ratingRequestQueue=[],"undefined"!=typeof tireRatingAjax&&(isLoggedIn=!0===tireRatingAjax.is_logged_in||"1"===tireRatingAjax.is_logged_in||1===tireRatingAjax.is_logged_in),"undefined"==typeof tireRatingAjax)return console.warn("WordPress rating system not available"),void e();const n=new FormData;n.append("action","get_tire_ratings"),tireRatingAjax.nonce&&n.append("nonce",tireRatingAjax.nonce),t.forEach(e=>{n.append("tire_ids[]",e)}),fetch(tireRatingAjax.ajaxurl,{method:"POST",body:n}).then(e=>e.json()).then(t=>{t.success&&(tireRatings={...tireRatings,...t.data.ratings},userRatings={...userRatings,...t.data.user_ratings},isLoggedIn=!0===t.data.is_logged_in||"1"===t.data.is_logged_in||1===t.data.is_logged_in),e()}).catch(t=>{console.error("Error loading tire ratings:",t),e()})},50)})):Promise.resolve()}function submitTireRating(e,t){if(!VALIDATION_PATTERNS.tireId.test(e))return console.error("Invalid tire ID format"),Promise.reject("Invalid tire ID");const n=validateNumeric(t,NUMERIC_BOUNDS.rating);if(n!==t)return console.error("Invalid rating value"),Promise.reject("Invalid rating");if(!isLoggedIn)return"undefined"!=typeof tireRatingAjax&&tireRatingAjax.login_url?window.location.href=tireRatingAjax.login_url:alert("Please log in to rate tires"),Promise.reject("Not logged in");if("undefined"==typeof tireRatingAjax||!tireRatingAjax.nonce)return console.error("Missing security nonce"),Promise.reject("Security validation failed");const r=new FormData;return r.append("action","submit_tire_rating"),r.append("tire_id",e),r.append("rating",n.toString()),r.append("nonce",tireRatingAjax.nonce),fetch(tireRatingAjax.ajaxurl,{method:"POST",body:r}).then(e=>e.json()).then(t=>{if(t.success)return tireRatings[e]={average:validateNumeric(t.data.average_rating,{min:0,max:5}),count:validateNumeric(t.data.rating_count,{min:0,max:1e4})},userRatings[e]=validateNumeric(t.data.user_rating,NUMERIC_BOUNDS.rating),updateRatingDisplay(e),t.data;throw new Error(t.data||"Failed to save rating")})}function createRatingHTML(e,t=0,n=0,r=0){if(!VALIDATION_PATTERNS.tireId.test(e))return console.error("Invalid tire ID in rating creation"),"<div>Error: Invalid tire data</div>";const a=validateNumeric(t,{min:0,max:5},0),i=validateNumeric(n,{min:0,max:1e4},0),o=r&&r>0?validateNumeric(r,NUMERIC_BOUNDS.rating,0):0,s=isLoggedIn,c=a>=4.5&&i>=2,l=document.createElement("div");l.className="tire-rating-container",l.dataset.tireId=e,c&&(l.dataset.highRating="true");const d=document.createElement("div");d.className="rating-display";const u=document.createElement("div");u.className=`rating-stars ${s?"interactive":""} ${o>0?"has-user-rating":""}`,u.dataset.tireId=e,u.setAttribute("role",s?"radiogroup":"img"),u.setAttribute("aria-label",a>0?`Rating: ${a.toFixed(1)} out of 5 stars`:"No ratings yet");for(let t=1;t<=5;t++){const n=document.createElement("span");n.className="star",n.dataset.rating=t.toString(),n.dataset.tireId=e,n.textContent="★",a>0&&t<=Math.round(a)&&n.classList.add("active"),o>0&&t<=o&&n.classList.add("user-rated"),s?(n.style.cursor="pointer",n.setAttribute("role","radio"),n.setAttribute("aria-checked",o===t?"true":"false"),n.setAttribute("aria-label",`${t} star${1!==t?"s":""}`),n.setAttribute("tabindex",t===(o||1)?"0":"-1")):n.setAttribute("aria-hidden","true"),u.appendChild(n)}const g=document.createElement("div");g.className="rating-info";const m=document.createElement("span");if(m.className="rating-average",m.textContent=a>0?a.toFixed(1):"No ratings",g.appendChild(m),i>0){const e=document.createElement("span");e.className="rating-count",e.textContent=`(${i} rating${1!==i?"s":""})`,g.appendChild(e)}if(d.appendChild(u),d.appendChild(g),l.appendChild(d),!isLoggedIn){const e=document.createElement("div");e.className="login-prompt",e.style.cssText="font-size: 12px; color: #9ca3af; margin-top: 4px;";const t=document.createElement("a");t.href="undefined"!=typeof tireRatingAjax?tireRatingAjax.login_url:"/wp-login.php",t.style.color=rtgColor("accent"),t.textContent="Log in",e.appendChild(t),e.appendChild(document.createTextNode(" to rate this tire")),l.appendChild(e)}return l.outerHTML}function updateRatingDisplay(e){if(!VALIDATION_PATTERNS.tireId.test(e))return void console.error("Invalid tire ID in rating update");const t=document.querySelector(`[data-tire-id="${CSS.escape(e)}"] .tire-rating-container`);if(!t)return;const n=tireRatings[e]||{average:0,count:0},r=userRatings[e]||0;t.outerHTML=createRatingHTML(e,n.average,n.count,r)}function setupEventDelegation(){eventDelegationSetup||(document.addEventListener("click",function(e){const t=e.target.closest(".rating-stars.interactive .star");if(!t)return;const n=t.dataset.tireId,r=parseInt(t.dataset.rating);!VALIDATION_PATTERNS.tireId.test(n)||!Number.isInteger(r)||r<1||r>5?console.error("Invalid rating data"):(t.style.opacity="0.5",submitTireRating(n,r).then(()=>{}).catch(e=>{console.error("Rating submission failed:",e),t.style.opacity="1",alert("Failed to save rating. Please try again.")}))}),document.addEventListener("mouseenter",function(e){const t=e.target.closest(".rating-stars.interactive .star");if(!t||!isLoggedIn)return;const n=parseInt(t.dataset.rating);if(!Number.isInteger(n)||n<1||n>5)return;t.closest(".rating-stars").querySelectorAll(".star").forEach((e,t)=>{t<n?e.classList.add("hover"):e.classList.remove("hover")})},!0),document.addEventListener("mouseleave",function(e){const t=e.target.closest(".rating-stars");if(!t)return;t.querySelectorAll(".star").forEach(e=>e.classList.remove("hover"))},!0),document.addEventListener("keydown",function(e){const t=e.target.closest(".rating-stars.interactive .star");if(!t)return;const n=t.closest(".rating-stars"),r=Array.from(n.querySelectorAll(".star")),a=r.indexOf(t);if("ArrowRight"===e.key||"ArrowUp"===e.key){e.preventDefault();const n=r[Math.min(a+1,r.length-1)];n.setAttribute("tabindex","0"),t.setAttribute("tabindex","-1"),n.focus()}else if("ArrowLeft"===e.key||"ArrowDown"===e.key){e.preventDefault();const n=r[Math.max(a-1,0)];n.setAttribute("tabindex","0"),t.setAttribute("tabindex","-1"),n.focus()}else"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())}),eventDelegationSetup=!0)}function applyFiltersFromURL(){const e=new URLSearchParams(window.location.search),t=(e,t)=>{const n=document.getElementById(e);n&&(n.checked="1"===t)},n=e.get("search");n&&((e,t)=>{const n=document.getElementById(e);if(n&&null!==t){const e=sanitizeInput(t,VALIDATION_PATTERNS.search);n.value=e}})("searchInput",n);const r=sanitizeInput(e.get("size"));if(r&&VALID_SIZES.includes(r)){const e=document.getElementById("filterSize");e&&(e.value=r)}const a=sanitizeInput(e.get("brand"));if(a&&VALID_BRANDS.includes(a)){const e=document.getElementById("filterBrand");e&&(e.value=a)}const i=sanitizeInput(e.get("category"));if(i&&VALID_CATEGORIES.includes(i)){const e=document.getElementById("filterCategory");e&&(e.value=i)}t("filter3pms",e.get("3pms")),t("filterEVRated",e.get("ev")),t("filterStudded",e.get("studded"));const o=e.get("sort");if(o&&ALLOWED_SORT_OPTIONS.includes(o)){const e=document.getElementById("sortBy");e&&(e.value=o)}const s=e.get("price"),c=e.get("warranty"),l=e.get("weight");if(s){const e=validateNumeric(s,NUMERIC_BOUNDS.price,600),t=document.getElementById("priceMax");t&&(t.value=e)}if(c){const e=validateNumeric(c,NUMERIC_BOUNDS.warranty,8e4),t=document.getElementById("warrantyMax");t&&(t.value=e)}if(l){const e=validateNumeric(l,NUMERIC_BOUNDS.weight,70),t=document.getElementById("weightMax");t&&(t.value=e)}const d=e.get("page");if(d){const e=validateNumeric(d,NUMERIC_BOUNDS.page,1);currentPage=e}else currentPage=1}function applyCompareFromURL(){const e=new URLSearchParams(window.location.search).get("compare");if(!e)return;const t=e.split(",").map(e=>validateNumeric(parseInt(e.trim()),{min:0,max:1e4},-1)).filter(e=>e>=0).slice(0,4);compareList=t,document.querySelectorAll(".compare-checkbox").forEach(e=>{const t=parseInt(e.dataset.index);compareList.includes(t)&&(e.checked=!0)}),updateCompareBar()}function applyTireDeepLink(){const e=new URLSearchParams(window.location.search).get("tire");if(!e||!VALIDATION_PATTERNS.tireId.test(e))return;const t=allRows.find(t=>t[0]===e);if(!t)return;filteredRows=[t],currentPage=1;const n=document.querySelector(".filter-wrapper"),r=document.querySelector(".sort-wrapper"),a=getDOMElement("activeFilters"),i=getDOMElement("paginationControls"),o=document.querySelector(".toggle-filters-btn");n&&(n.style.display="none"),r&&(r.style.display="none"),a&&(a.style.display="none"),i&&(i.style.display="none"),o&&(o.style.display="none");const s=getDOMElement("tireSection");if(s){const e=document.createElement("div");e.className="tire-deeplink-bar";const t=document.createElement("a");t.href=window.location.pathname,t.className="tire-deeplink-back",t.innerHTML='<i class="fa-solid fa-arrow-left"></i> View all tires',e.appendChild(t),s.parentNode.insertBefore(e,s)}}function renderCards(e){cardContainer||(cardContainer=getDOMElement("tireCards")),"undefined"!=typeof tireRatingAjax&&(isLoggedIn=!0===tireRatingAjax.is_logged_in||"1"===tireRatingAjax.is_logged_in||1===tireRatingAjax.is_logged_in);const t=window.matchMedia("(prefers-reduced-motion: reduce)").matches,n=window.innerWidth<=768||/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),r=t?0:n?200:300,a=t?0:n?100:150,i=new Set(e.map(e=>e[0]).filter(e=>VALIDATION_PATTERNS.tireId.test(e))),o=Array.from(cardContainer.children),s=new Set,c=[];o.forEach(t=>{const n=t.dataset.tireId;if(i.has(n)){s.add(n);const r=e.find(e=>e[0]===n);if(r){const e=t.querySelector(".compare-checkbox");e&&(e.dataset.index=allRows.indexOf(r))}}else c.push(t)}),c.forEach(e=>{t?e.parentNode&&e.parentNode.removeChild(e):(e.style.transition=`opacity ${r}ms ease, transform ${r}ms ease`,e.style.opacity="0",e.style.transform=n?"scale(0.98)":"scale(0.95)",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},a))});const l=[];e.forEach((e,r)=>{const a=e[0];if(VALIDATION_PATTERNS.tireId.test(a)&&!s.has(a)){const r=createSingleCard(e);r&&(t||(r.style.opacity="0",r.style.transform=n?"scale(0.98)":"scale(0.95)"),l.push(r))}});const d=document.createDocumentFragment();l.forEach(e=>d.appendChild(e)),cardContainer.appendChild(d),!t&&l.length>0?requestAnimationFrame(()=>{l.forEach((e,t)=>{setTimeout(()=>{e.style.transition=`opacity ${r}ms ease, transform ${r}ms ease`,e.style.opacity="1",e.style.transform="scale(1)"},n?50*t:0)})}):t&&l.forEach(e=>{e.style.opacity="1",e.style.transform="scale(1)"});const u=Array.from(cardContainer.children);e.some((e,t)=>{const n=e[0],r=u[t];return!r||r.dataset.tireId!==n})&&e.forEach((e,t)=>{const n=e[0];if(!VALIDATION_PATTERNS.tireId.test(n))return;const r=cardContainer.querySelector(`[data-tire-id="${CSS.escape(n)}"]`);if(r){if(Array.from(cardContainer.children).indexOf(r)!==t){const e=cardContainer.children[t];e&&e!==r?cardContainer.insertBefore(r,e):e||cardContainer.appendChild(r)}}}),setupCompareCheckboxes()}function createSingleCard(e){const[t,n,r,a,i,o,s,c,l,d,u,g,m,p,f,h,y,v,S,x,E,w,C]=e;if(!VALIDATION_PATTERNS.tireId.test(t))return console.error("Invalid tire ID in card creation:",t),null;const b=`card_${t}_${Date.now()%1e4}`,R=tireRatings[t]||{average:0,count:0},I=userRatings[t]||0,M=createRatingHTML(t,R.average,R.count,I),A=safeLinkURL(S),L=safeImageURL(x),N=safeBundleLinkURL(C),T=document.createElement("div");if(T.className="tire-card",T.dataset.tireId=t,safeString(v).toLowerCase().includes("reviewed")){const e=document.createElement("div");e.className="tire-card-badge";const t=document.createElement("div");t.className="tire-card-badge-inner";const n=document.createElement("i");n.className="fa-solid fa-circle-check",t.appendChild(n),t.appendChild(document.createTextNode("Reviewed")),e.appendChild(t),T.appendChild(e)}const D=document.createElement("label");D.className="tire-card-compare-overlay",D.setAttribute("aria-label",`Compare ${escapeHTML(safeString(a))} ${escapeHTML(safeString(i))}`);const O=document.createElement("input");O.type="checkbox",O.className="compare-checkbox",O.dataset.id=t,O.dataset.index=allRows.indexOf(e).toString();const _=document.createElement("span");_.className="compare-overlay-icon",D.appendChild(O),D.appendChild(_);const k=document.createElement("button");if(k.className="tire-card-share-btn",k.setAttribute("aria-label",`Share ${escapeHTML(safeString(a))} ${escapeHTML(safeString(i))}`),k.innerHTML='<i class="fa-solid fa-share-nodes"></i>',k.addEventListener("click",e=>{e.stopPropagation();const n=new URL(window.location.href);n.search="",n.searchParams.set("tire",t);const r=n.toString(),o=`${safeString(a)} ${safeString(i)}`;navigator.share?navigator.share({title:o,url:r}).catch(()=>{}):navigator.clipboard&&navigator.clipboard.writeText(r).then(function(){k.innerHTML='<i class="fa-solid fa-check"></i>',k.classList.add("copied"),setTimeout(()=>{k.innerHTML='<i class="fa-solid fa-share-nodes"></i>',k.classList.remove("copied")},2e3)})}),L){const e=document.createElement("div");e.className="tire-card-image";const t=document.createElement("img");t.src=L,t.alt=`${escapeHTML(safeString(a))} ${escapeHTML(safeString(i))}`,t.loading="lazy",t.fetchpriority="low",t.onclick=()=>openImageModal(L,`${escapeHTML(safeString(a))} ${escapeHTML(safeString(i))}`),e.appendChild(t),e.appendChild(D),e.appendChild(k),T.appendChild(e)}else T.appendChild(D),T.appendChild(k);const P=document.createElement("div");P.className="tire-card-body";const U=document.createElement("div");U.className="tire-card-brand",U.textContent=safeString(a),P.appendChild(U);const B=document.createElement("div");B.className="tire-card-model",B.textContent=safeString(i),P.appendChild(B);const F=document.createElement("div");F.innerHTML=M,P.appendChild(F);const $=document.createElement("div");if($.className="tire-card-tags",w){const e=safeString(w).trim().toUpperCase();if(["A","B","C","D","E","F"].includes(e)){const t={A:"#5ec095",B:"#a3e635",C:"#facc15",D:"#f97316",E:"#ef4444",F:"#b91c1c"}[e],n=document.createElement("span");n.className="tire-card-eff";const r=document.createElement("span");r.className="tire-card-eff-grade",r.style.backgroundColor=t,r.textContent=e;const a=document.createElement("span");a.className="tire-card-eff-score";const i=document.createElement("span");i.textContent=`Efficiency (${escapeHTML(safeString(E))}/100)`;const o=document.createElement("button");o.innerHTML='<i class="fa-solid fa-circle-info"></i>',o.className="info-tooltip-trigger",o.dataset.tooltipKey="Efficiency Score",o.style.cssText="\n        background: none;\n        border: none;\n        color: #94a3b8;\n        font-size: 12px;\n        cursor: pointer;\n        padding: 1px;\n        border-radius: 50%;\n        width: 16px;\n        height: 16px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s ease;\n      ",o.addEventListener("mouseenter",()=>{o.style.color=rtgColor("accent"),o.style.backgroundColor=`color-mix(in srgb, ${rtgColor("accent")} 10%, transparent)`}),o.addEventListener("mouseleave",()=>{o.style.color="#94a3b8",o.style.backgroundColor="transparent"}),a.appendChild(i),a.appendChild(o),n.appendChild(r),n.appendChild(a),$.appendChild(n)}}if(v&&safeString(v).trim()){safeString(v).split(/[,|]/).map(e=>e.trim()).filter(e=>e&&"reviewed"!==e.toLowerCase()).forEach(e=>{const t=document.createElement("span");t.className="tire-card-tag",t.textContent=safeString(e,30),$.appendChild(t)})}$.children.length>0&&P.appendChild($);const z=document.createElement("div");z.className="tire-card-specs";[["Size",`${safeString(n)} (${safeString(r)}${safeString(r)&&!safeString(r).includes('"')?'"':""})`],["Category",safeString(o)],["Average Price",s?`$${validateNumeric(s,NUMERIC_BOUNDS.price)}`:"-"],["Mileage Warranty",c?`${Number(validateNumeric(c,NUMERIC_BOUNDS.warranty)).toLocaleString()} miles`:"-"],["Weight",l?`${validateNumeric(l,NUMERIC_BOUNDS.weight)} lb`:"-"],["3PMS Rated",safeString(d)],["Tread Depth",safeString(u)],["Load Index",safeString(g)],["Max Load",m?`${validateNumeric(m,{min:0,max:1e4})} lb`:"-"],["Load Range",safeString(p)],["Speed Rating",safeString(f)],["Max PSI",safeString(h)],["UTQG",safeString(y)]].forEach(([e,t])=>{const n=document.createElement("div");n.className="tire-card-spec";let r;TOOLTIP_DATA.hasOwnProperty(e)?r=createInfoTooltip(e,e):(r=document.createElement("span"),r.className="tire-card-spec-label",r.textContent=e);const a=document.createElement("span");a.className="tire-card-spec-value",a.textContent=t||"-",n.appendChild(r),n.appendChild(a),z.appendChild(n)}),P.appendChild(z),T.appendChild(P);const V=document.createElement("div");if(V.className="tire-card-actions",A){const e=document.createElement("a");e.href=A,e.target="_blank",e.rel="noopener noreferrer",e.className="tire-card-cta tire-card-cta-primary",e.innerHTML='View Tire&nbsp;<i class="fa-solid fa-square-up-right"></i>',V.appendChild(e)}else{const e=document.createElement("span");e.className="tire-card-cta tire-card-cta-disabled",e.textContent="Coming Soon",V.appendChild(e)}if(N){const e=document.createElement("a");e.href=N,e.target="_blank",e.rel="noopener noreferrer",e.className="tire-card-cta tire-card-cta-bundle",e.innerHTML='Wheel & Tire from EV Sportline&nbsp;<i class="fa-solid fa-square-up-right"></i>',V.appendChild(e)}if(T.appendChild(V),cardCache.size>100){const e=cardCache.keys().next().value;cardCache.delete(e)}return cardCache.set(b,T.cloneNode(!0)),T}function setupCompareCheckboxes(){document.querySelectorAll(".compare-checkbox:not([data-listener-attached])").forEach(e=>{e.dataset.listenerAttached="true",e.addEventListener("change",()=>{const t=parseInt(e.dataset.index);if(Number.isInteger(t)&&!(t<0)){if(e.checked){if(compareList.length>=4)return void(e.checked=!1);compareList.includes(t)||compareList.push(t)}else compareList=compareList.filter(e=>e!==t);updateCompareBar(),document.querySelectorAll(".compare-checkbox").forEach(e=>{e.checked||(e.disabled=compareList.length>=4)})}})})}function preloadNextPageImages(){const e=Math.ceil(filteredRows.length/ROWS_PER_PAGE);if(currentPage>=e)return;const t=currentPage*ROWS_PER_PAGE;filteredRows.slice(t,t+ROWS_PER_PAGE).forEach(e=>{const t=safeImageURL(e[19]);if(t){(new Image).src=t}})}function paginate(e){const t=(currentPage-1)*ROWS_PER_PAGE;return e.slice(t,t+ROWS_PER_PAGE)}function renderPaginationControls(e){const t=getDOMElement("paginationControls");t.innerHTML="";const n=Math.ceil(e.length/ROWS_PER_PAGE);if(n<=1)return;const r=document.createElement("button");r.textContent="Previous",r.disabled=1===currentPage,styleButton(r),r.onclick=()=>{currentPage--,render(),updateURLFromFilters();const e=getDOMElement("filterTop");e&&e.scrollIntoView({behavior:"smooth"})},t.appendChild(r);const a=document.createElement("span");a.textContent=`Page ${currentPage} of ${n}`,a.style.cssText=`color: ${rtgColor("text-primary")}; font-weight: 500; display: flex; align-items: center;`,t.appendChild(a);const i=document.createElement("button");i.textContent="Next",i.disabled=currentPage===n,styleButton(i),i.onclick=()=>{currentPage++,render(),updateURLFromFilters();const e=getDOMElement("filterTop");e&&e.scrollIntoView({behavior:"smooth"})},t.appendChild(i)}function styleButton(e){e.style.backgroundColor=rtgColor("bg-primary"),e.style.color=rtgColor("text-primary"),e.style.padding="8px 16px",e.style.border="none",e.style.borderRadius="6px",e.style.cursor="pointer",e.style.fontWeight="600",e.onmouseover=()=>e.style.backgroundColor=rtgColor("accent"),e.onmouseout=()=>e.style.backgroundColor=rtgColor("bg-primary")}function render(){const e=paginate(filteredRows);loadTireRatings(e.map(e=>e[0]).filter(Boolean)).then(()=>{renderCards(e),renderPaginationControls(filteredRows);const t=getDOMElement("noResults"),n=getDOMElement("tireCards");0===filteredRows.length?(t.style.display="block",n.style.display="none"):(t.style.display="none",n.style.display="grid"),"requestIdleCallback"in window?requestIdleCallback(()=>preloadNextPageImages()):setTimeout(preloadNextPageImages,100)})}function updateURLFromFilters(){const e=new URLSearchParams;currentPage>1&&e.set("page",currentPage);const t=e=>getDOMElement(e)?.value,n=e=>getDOMElement(e)?.checked,r=t("searchInput");r&&VALIDATION_PATTERNS.search.test(r)&&e.set("search",r);const a=t("filterSize");a&&VALID_SIZES.includes(a)&&e.set("size",a);const i=t("filterBrand");i&&VALID_BRANDS.includes(i)&&e.set("brand",i);const o=t("filterCategory");o&&VALID_CATEGORIES.includes(o)&&e.set("category",o),n("filter3pms")&&e.set("3pms","1"),n("filterEVRated")&&e.set("ev","1"),n("filterStudded")&&e.set("studded","1");const s=t("sortBy");s&&ALLOWED_SORT_OPTIONS.includes(s)&&"rating-desc"!==s&&e.set("sort",s);const c=parseInt(t("priceMax"));c&&600!==c&&c>=0&&c<=2e3&&e.set("price",c);const l=parseInt(t("warrantyMax"));l&&8e4!==l&&l>=0&&l<=1e5&&e.set("warranty",l);const d=parseInt(t("weightMax"));d&&70!==d&&d>=0&&d<=200&&e.set("weight",d);const u=e.toString()?`${location.pathname}?${e.toString()}`:`${location.pathname}`;history.replaceState(null,"",u)}function getFilteredIndexes(e){let t=new Set(allRows.map((e,t)=>t));if(e.Size){const n=new Set(sizeIndex.get(e.Size.toLowerCase())||[]);t=new Set([...t].filter(e=>n.has(e)))}if(e.Brand){const n=new Set(brandIndex.get(e.Brand.toLowerCase())||[]);t=new Set([...t].filter(e=>n.has(e)))}if(e.Category){const n=new Set(categoryIndex.get(e.Category.toLowerCase())||[]);t=new Set([...t].filter(e=>n.has(e)))}if(e.PriceMax<600){const n=binarySearchMax(priceIndex,e.PriceMax);t=new Set([...t].filter(e=>n.has(e)))}if(e.WarrantyMax<8e4){const n=binarySearchMax(warrantyIndex,e.WarrantyMax);t=new Set([...t].filter(e=>n.has(e)))}if(e.WeightMax<70){const n=binarySearchMax(weightIndex,e.WeightMax);t=new Set([...t].filter(e=>n.has(e)))}return[...t].map(e=>allRows[e]).filter(t=>{if(e.search){const n=safeString(t[3]),r=safeString(t[4]),a=`${n} ${r}`,i=isPreciseMatch(n,e.search),o=isPreciseMatch(r,e.search),s=isPreciseMatch(a,e.search);if(!i&&!o&&!s)return!1}return!(e["3PMS"]&&!safeString(t[9]).toLowerCase().includes("yes"))&&(!(e.EVRated&&!safeString(t[17]).toLowerCase().includes("ev rated"))&&!(e.Studded&&!safeString(t[17]).toLowerCase().includes("studded available")))})}function filterAndRender(){const e=document.querySelector("#searchInput"),t=getDOMElement("priceMax"),n=getDOMElement("warrantyMax"),r=getDOMElement("weightMax"),a=getDOMElement("filter3pms"),i=getDOMElement("filterEVRated"),o=getDOMElement("filterStudded"),s=getDOMElement("filterSize"),c=getDOMElement("filterBrand"),l=getDOMElement("filterCategory"),d=getDOMElement("sortBy"),u=e?sanitizeInput(e.value,VALIDATION_PATTERNS.search):"",g=t?validateNumeric(t.value,NUMERIC_BOUNDS.price,600):600,m=n?validateNumeric(n.value,NUMERIC_BOUNDS.warranty,8e4):8e4,p=r?validateNumeric(r.value,NUMERIC_BOUNDS.weight,70):70,f={search:u.toLowerCase(),PriceMax:g,WarrantyMax:m,WeightMax:p,"3PMS":a?.checked||!1,EVRated:i?.checked||!1,Studded:o?.checked||!1,Size:s?.value&&VALID_SIZES.includes(s.value)?s.value:"",Brand:c?.value&&VALID_BRANDS.includes(c.value)?c.value:"",Category:l?.value&&VALID_CATEGORIES.includes(l.value)?l.value:""},h=d?.value&&ALLOWED_SORT_OPTIONS.includes(d.value)?d.value:"",y=JSON.stringify({...f,sortOption:h,currentPage:currentPage});if(lastFilterState!==y)if(lastFilterState=y,filteredRows=getFilteredIndexes(f),"rating-desc"===h||"rating-asc"===h){loadTireRatings(filteredRows.map(e=>e[0]).filter(Boolean)).then(()=>{applySorting(h),finishFilterAndRender()})}else applySorting(h),finishFilterAndRender()}function applySorting(e){if(e&&"efficiencyGrade"!==e)switch(e){case"reviewed":filteredRows.sort((e,t)=>{const n=safeString(e[17]).toLowerCase().includes("reviewed");return safeString(t[17]).toLowerCase().includes("reviewed")-n});break;case"rating-desc":filteredRows.sort((e,t)=>{const n=validateNumeric(tireRatings[e[0]]?.average,{min:0,max:5},0),r=validateNumeric(tireRatings[t[0]]?.average,{min:0,max:5},0)-n;if(Math.abs(r)<.01){const n=validateNumeric(tireRatings[e[0]]?.count,{min:0,max:1e4},0),r=validateNumeric(tireRatings[t[0]]?.count,{min:0,max:1e4},0)-n;return Math.abs(r)<.01?safeString(e[0]).localeCompare(safeString(t[0])):r}return r});break;case"rating-asc":filteredRows.sort((e,t)=>{const n=validateNumeric(tireRatings[e[0]]?.average,{min:0,max:5},0)-validateNumeric(tireRatings[t[0]]?.average,{min:0,max:5},0);if(Math.abs(n)<.01){const n=validateNumeric(tireRatings[e[0]]?.count,{min:0,max:1e4},0),r=validateNumeric(tireRatings[t[0]]?.count,{min:0,max:1e4},0)-n;return Math.abs(r)<.01?safeString(e[0]).localeCompare(safeString(t[0])):r}return n});break;case"price-asc":filteredRows.sort((e,t)=>validateNumeric(e[6],NUMERIC_BOUNDS.price,0)-validateNumeric(t[6],NUMERIC_BOUNDS.price,0));break;case"price-desc":filteredRows.sort((e,t)=>validateNumeric(t[6],NUMERIC_BOUNDS.price,0)-validateNumeric(e[6],NUMERIC_BOUNDS.price,0));break;case"warranty-desc":filteredRows.sort((e,t)=>validateNumeric(t[7],NUMERIC_BOUNDS.warranty,0)-validateNumeric(e[7],NUMERIC_BOUNDS.warranty,0));break;case"weight-asc":filteredRows.sort((e,t)=>validateNumeric(e[8],NUMERIC_BOUNDS.weight,0)-validateNumeric(t[8],NUMERIC_BOUNDS.weight,0));break;case"weight-desc":filteredRows.sort((e,t)=>validateNumeric(t[8],NUMERIC_BOUNDS.weight,0)-validateNumeric(e[8],NUMERIC_BOUNDS.weight,0));break;case"alpha":filteredRows.sort((e,t)=>safeString(e[3]).toLowerCase().localeCompare(safeString(t[3]).toLowerCase()));break;case"alpha-desc":filteredRows.sort((e,t)=>safeString(t[3]).toLowerCase().localeCompare(safeString(e[3]).toLowerCase()))}else filteredRows.sort((e,t)=>{const n=validateNumeric(e[20],{min:0,max:100},0);return validateNumeric(t[20],{min:0,max:100},0)-n})}function finishFilterAndRender(){const e=getDOMElement("tireCount");e&&(e.textContent=`Showing ${filteredRows.length} tire${1===filteredRows.length?"":"s"}`),currentPage=1,throttledRender(),updateURLFromFilters(),renderActiveFilterChips()}function populateDropdown(e,t){const n=getDOMElement(e);if(!n)return;[...new Set(t.map(e=>safeString(e).trim()))].filter(e=>e&&e.length<=100).sort((e,t)=>e.localeCompare(t)).slice(0,200).forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)})}function populateSizeDropdownGrouped(e,t){const n=getDOMElement(e);if(!n)return;const r=[...new Set(t.map(e=>safeString(e[1])).filter(e=>e))],a={};r.forEach(e=>{const t=e.match(/R(\d{2})/i),n=t?t[1]:"Other";a[n]||(a[n]=[]),a[n].push(e)});const i=Object.keys(a).sort((e,t)=>"Other"===e?1:"Other"===t?-1:parseInt(e)-parseInt(t));n.innerHTML="";const o=document.createElement("option");o.value="",o.textContent="All Sizes",n.appendChild(o),i.forEach(e=>{const t=document.createElement("optgroup");t.label=`${e}" Wheels`,a[e].sort().forEach(e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}),n.appendChild(t)})}function setupSliderHandlers(){[{id:"priceMax",label:"priceVal",format:e=>`$${e}`,bounds:NUMERIC_BOUNDS.price},{id:"warrantyMax",label:"warrantyVal",format:e=>`${Number(e).toLocaleString()} miles`,bounds:NUMERIC_BOUNDS.warranty},{id:"weightMax",label:"weightVal",format:e=>`${e} lb`,bounds:NUMERIC_BOUNDS.weight}].forEach(({id:e,label:t,format:n,bounds:r})=>{const a=getDOMElement(e),i=getDOMElement(t);if(a&&i){a.addEventListener("input",()=>{const e=validateNumeric(a.value,r,r.max);a.value=e,i.textContent=n(e),updateSliderBackground(a)}),a.addEventListener("input",debounce(filterAndRender,400));const e=validateNumeric(a.value,r,r.max);i.textContent=n(e),updateSliderBackground(a)}})}function resetFilters(){[{id:"searchInput",value:""},{id:"filterSize",value:""},{id:"filterBrand",value:""},{id:"filterCategory",value:""},{id:"priceMax",value:600},{id:"warrantyMax",value:8e4},{id:"weightMax",value:70},{id:"sortBy",value:"rating-desc"}].forEach(({id:e,value:t})=>{const n=getDOMElement(e);n&&(n.value=t)});["filter3pms","filterEVRated","filterStudded"].forEach(e=>{const t=getDOMElement(e);t&&(t.checked=!1)});[{id:"priceVal",text:"$600"},{id:"warrantyVal",text:"80,000 miles"},{id:"weightVal",text:"70 lb"}].forEach(({id:e,text:t})=>{const n=getDOMElement(e);n&&(n.textContent=t)}),["priceMax","warrantyMax","weightMax"].forEach(e=>{const t=getDOMElement(e);t&&updateSliderBackground(t)}),hideSearchSuggestions(),delete domCache.searchInput,lastFilterState=null,document.dispatchEvent(new CustomEvent("filtersReset")),filterAndRender(),history.replaceState(null,"",location.pathname)}function renderActiveFilterChips(){const e=getDOMElement("activeFilters");if(!e)return;const t=[],n=getDOMElement("searchInput")?.value?.trim();n&&t.push({label:"Search",value:n,clear:()=>{const e=getDOMElement("searchInput");e&&(e.value=""),delete domCache.searchInput}});const r=getDOMElement("filterSize");r?.value&&t.push({label:"Size",value:r.value,clear:()=>{r.value=""}});const a=getDOMElement("filterBrand");a?.value&&t.push({label:"Brand",value:a.value,clear:()=>{a.value=""}});const i=getDOMElement("filterCategory");i?.value&&t.push({label:"Category",value:i.value,clear:()=>{i.value=""}});const o=getDOMElement("priceMax"),s=o?parseInt(o.value):600;s<600&&t.push({label:"Price",value:"≤ $"+s,clear:()=>{o.value=600;const e=getDOMElement("priceVal");e&&(e.textContent="$600"),updateSliderBackground(o)}});const c=getDOMElement("warrantyMax"),l=c?parseInt(c.value):8e4;l<8e4&&t.push({label:"Warranty",value:"≤ "+Number(l).toLocaleString()+" mi",clear:()=>{c.value=8e4;const e=getDOMElement("warrantyVal");e&&(e.textContent="80,000 miles"),updateSliderBackground(c)}});const d=getDOMElement("weightMax"),u=d?parseInt(d.value):70;u<70&&t.push({label:"Weight",value:"≤ "+u+" lb",clear:()=>{d.value=70;const e=getDOMElement("weightVal");e&&(e.textContent="70 lb"),updateSliderBackground(d)}}),getDOMElement("filter3pms")?.checked&&t.push({label:"3PMS",value:"Yes",clear:()=>{getDOMElement("filter3pms").checked=!1}}),getDOMElement("filterEVRated")?.checked&&t.push({label:"EV Rated",value:"Yes",clear:()=>{getDOMElement("filterEVRated").checked=!1}}),getDOMElement("filterStudded")?.checked&&t.push({label:"Studded",value:"Yes",clear:()=>{getDOMElement("filterStudded").checked=!1}}),e.innerHTML="",t.forEach(t=>{const n=document.createElement("span");n.className="filter-chip";const r=document.createElement("span");r.className="filter-chip-label",r.textContent=t.label+":";const a=document.createElement("span");a.textContent=t.value;const i=document.createElement("button");i.className="filter-chip-dismiss",i.setAttribute("aria-label","Remove "+t.label+" filter"),i.innerHTML='<i class="fa-solid fa-xmark"></i>',i.addEventListener("click",()=>{t.clear(),lastFilterState=null,filterAndRender()}),n.appendChild(r),n.appendChild(a),n.appendChild(i),e.appendChild(n)})}function updateCompareBar(){const e=getDOMElement("compareBar"),t=getDOMElement("compareCount");if(!e||!t)return;const n=Math.max(0,Math.min(4,compareList.length));t.textContent=`${n} of 4 tires selected`,e.style.display=n>=2?"flex":"none"}function openComparison(){if(!compareList.length)return;const e=compareList.filter(e=>Number.isInteger(e)&&e>=0&&e<allRows.length).slice(0,4);if(e.length)try{const t="undefined"!=typeof rtgData&&rtgData.settings&&rtgData.settings.compareUrl?rtgData.settings.compareUrl:"/tire-compare/",n=new URL(t,location.origin);n.searchParams.set("compare",e.join(",")),window.open(n.toString(),"_blank","noopener,noreferrer")}catch(e){console.error("Error creating comparison URL:",e)}}function clearCompare(){compareList=[],document.querySelectorAll(".compare-checkbox").forEach(e=>{e.checked=!1,e.disabled=!1}),updateCompareBar()}function initializeUI(){const e=isServerSide(),t=e?serverSideFilterAndRender:filterAndRender,n=debounce(e?serverSideFilterAndRender:filterAndRender,500);e||(VALID_SIZES=[...new Set(allRows.map(e=>safeString(e[1]).trim()))].filter(Boolean),VALID_BRANDS=[...new Set(allRows.map(e=>safeString(e[3]).trim()))].filter(Boolean),VALID_CATEGORIES=[...new Set(allRows.map(e=>safeString(e[5]).trim()))].filter(Boolean),populateSizeDropdownGrouped("filterSize",allRows),populateDropdown("filterBrand",allRows.map(e=>e[3])),populateDropdown("filterCategory",allRows.map(e=>e[5])));if([{id:"searchInput",listener:n},{id:"filterSize",listener:t},{id:"filterBrand",listener:t},{id:"filterCategory",listener:t},{id:"filter3pms",listener:t},{id:"filterEVRated",listener:t},{id:"filterStudded",listener:t}].forEach(({id:e,listener:t})=>{const n=getDOMElement(e);n&&n.addEventListener("input",t)}),applyFiltersFromURL(),applyCompareFromURL(),setupSliderHandlers(),setupEventDelegation(),initializeSmartSearch(),e){["priceMax","warrantyMax","weightMax"].forEach(e=>{const t=getDOMElement(e);t&&t.addEventListener("input",debounce(serverSideFilterAndRender,500))}),fetchDropdownOptions().then(()=>{fetchTiresFromServer(currentPage)})}else{buildFilterIndexes(),filterAndRender(),applyTireDeepLink();const e=getDOMElement("tireCount");e&&(e.textContent=`Showing ${filteredRows.length} tire${1!==filteredRows.length?"s":""}`)}}let serverSideMode=!1,serverSideTotal=0,serverSideFetchController=null;function isServerSide(){return serverSideMode&&"undefined"!=typeof rtgData&&rtgData.settings&&rtgData.settings.ajaxurl}function fetchTiresFromServer(e){serverSideFetchController&&serverSideFetchController.abort(),serverSideFetchController=new AbortController;const t=document.querySelector("#searchInput"),n=new FormData;n.append("action","rtg_get_tires"),n.append("nonce",rtgData.settings.tireNonce),n.append("page",e||currentPage),n.append("search",t?t.value:""),n.append("size",getDOMElement("filterSize")?.value||""),n.append("brand",getDOMElement("filterBrand")?.value||""),n.append("category",getDOMElement("filterCategory")?.value||""),n.append("three_pms",getDOMElement("filter3pms")?.checked?"1":""),n.append("ev_rated",getDOMElement("filterEVRated")?.checked?"1":""),n.append("studded",getDOMElement("filterStudded")?.checked?"1":""),n.append("price_max",getDOMElement("priceMax")?.value||"600"),n.append("weight_max",getDOMElement("weightMax")?.value||"70");const r=getDOMElement("warrantyMax"),a=r?parseInt(r.value):8e4;n.append("warranty_min",a<8e4?(8e4-a).toString():"0");const i=getDOMElement("sortBy"),o=i?.value||"efficiency_score";n.append("sort",{efficiencyGrade:"efficiency_score"}[o]||o);const s=getDOMElement("tireCount");return s&&(s.textContent="Loading..."),fetch(rtgData.settings.ajaxurl,{method:"POST",body:n,signal:serverSideFetchController.signal}).then(e=>e.json()).then(e=>{if(!e.success)return void console.error("Server tire fetch failed:",e);const t=(e.data.rows||[]).map(validateAndSanitizeCSVRow).filter(e=>e&&e.length&&e[0]);filteredRows=t,serverSideTotal=e.data.total||0,currentPage=e.data.page||1,s&&(s.textContent=`Showing ${serverSideTotal} tire${1===serverSideTotal?"":"s"}`),renderCards(filteredRows),renderServerPagination(serverSideTotal,e.data.per_page||ROWS_PER_PAGE,currentPage),updateURLFromFilters();const n=getDOMElement("noResults"),r=getDOMElement("tireCards");0===filteredRows.length?(n&&(n.style.display="block"),r&&(r.style.display="none")):(n&&(n.style.display="none"),r&&(r.style.display="grid"));loadTireRatings(filteredRows.map(e=>e[0]).filter(Boolean))}).catch(e=>{"AbortError"!==e.name&&console.error("Fetch error:",e)})}function renderServerPagination(e,t,n){const r=getDOMElement("paginationControls");if(!r)return;r.innerHTML="";const a=Math.ceil(e/t);if(a<=1)return;const i=document.createElement("button");i.textContent="Previous",i.disabled=n<=1,styleButton(i),i.onclick=()=>{currentPage=n-1,fetchTiresFromServer(currentPage),scrollToTop()},r.appendChild(i);const o=document.createElement("span");o.textContent=`Page ${n} of ${a}`,o.style.cssText=`color: ${rtgColor("text-primary")}; font-weight: 500; display: flex; align-items: center;`,r.appendChild(o);const s=document.createElement("button");s.textContent="Next",s.disabled=n>=a,styleButton(s),s.onclick=()=>{currentPage=n+1,fetchTiresFromServer(currentPage),scrollToTop()},r.appendChild(s)}function scrollToTop(){const e=getDOMElement("filterTop");e&&e.scrollIntoView({behavior:"smooth"})}function fetchDropdownOptions(){const e=new FormData;return e.append("action","rtg_get_filter_options"),e.append("nonce",rtgData.settings.tireNonce),fetch(rtgData.settings.ajaxurl,{method:"POST",body:e}).then(e=>e.json()).then(e=>{if(!e.success)return;const t=e.data;VALID_SIZES=t.sizes||[],VALID_BRANDS=t.brands||[],VALID_CATEGORIES=t.categories||[];const n=getDOMElement("filterSize");if(n){n.innerHTML="";const e=document.createElement("option");e.value="",e.textContent="All Sizes",n.appendChild(e);const t={};VALID_SIZES.forEach(e=>{const n=e.match(/R(\d{2})/i),r=n?n[1]:"Other";t[r]||(t[r]=[]),t[r].push(e)}),Object.keys(t).sort((e,t)=>"Other"===e?1:"Other"===t?-1:parseInt(e)-parseInt(t)).forEach(e=>{const r=document.createElement("optgroup");r.label=`${e}" Wheels`,t[e].sort().forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,r.appendChild(t)}),n.appendChild(r)})}populateDropdown("filterBrand",VALID_BRANDS),populateDropdown("filterCategory",VALID_CATEGORIES),applyFiltersFromURL()}).catch(e=>console.error("Failed to fetch filter options:",e))}function serverSideFilterAndRender(){currentPage=1,lastFilterState=null,fetchTiresFromServer(1),renderActiveFilterChips()}function openImageModal(e,t){const n=safeImageURL(e);if(!n)return void console.warn("Invalid image URL for modal:",e);const r=getDOMElement("imageModal"),a=getDOMElement("modalImage");if(!r||!a)return;a.src=n,a.alt=escapeHTML(safeString(t,200)),a.onerror=()=>{const e=safeImageURL("https://riviantrackr.com/assets/tire-guide/images/image404.jpg");e&&(a.src=e,a.alt="Image not available")},r.style.display="flex",document.body.style.overflow="hidden";const i=e=>{"Escape"===e.key&&(r.style.display="none",document.body.style.overflow="",document.removeEventListener("keydown",i))};document.addEventListener("keydown",i),r.onclick=e=>{e.target===r&&(r.style.display="none",document.body.style.overflow="",document.removeEventListener("keydown",i))}}"undefined"!=typeof rtgData&&rtgData.settings&&rtgData.settings.serverSide?(serverSideMode=!0,"undefined"!=typeof tireRatingAjax&&(isLoggedIn=!0===tireRatingAjax.is_logged_in||"1"===tireRatingAjax.is_logged_in||1===tireRatingAjax.is_logged_in),allRows=[],filteredRows=[],initializeUI()):"undefined"!=typeof rtgData&&rtgData.tires&&Array.isArray(rtgData.tires)?(allRows=rtgData.tires.map(validateAndSanitizeCSVRow).filter(e=>e&&e.length&&e[0]),filteredRows=allRows,"undefined"!=typeof tireRatingAjax&&(isLoggedIn=!0===tireRatingAjax.is_logged_in||"1"===tireRatingAjax.is_logged_in||1===tireRatingAjax.is_logged_in),initializeUI()):console.error("Tire guide data not available. Ensure the [rivian_tire_guide] shortcode is used."),document.addEventListener("click",e=>{const t=getDOMElement("compareModal"),n=t?.querySelector("div");"flex"===t?.style.display&&t.contains(e.target)&&!n?.contains(e.target)&&(t.style.display="none",document.body.style.overflow="")}),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".switch-label").forEach(e=>{const t=e.querySelector('input[type="checkbox"]'),n=e.querySelector(".switch-text");if(t&&n){let e=null,r="";switch(t.id){case"filter3pms":e="3PMS Filter",r="3PMS Rated";break;case"filterEVRated":e="EV Rated Filter",r="EV Rated";break;case"filterStudded":e="Studded Available Filter",r="Studded Available"}if(e){const t=createFilterTooltip(r,e);n.innerHTML="",n.appendChild(t)}}}),setTimeout(()=>{const e=document.querySelector(".switch-label:has(input#filter3pms) .switch-text");if(e){const t=createFilterTooltip("3PMS Rated","3PMS Filter");e.innerHTML="",e.appendChild(t)}else{const e=document.getElementById("filter3pms");if(e){const t=e.parentElement.querySelector(".switch-text");if(t){const e=createFilterTooltip("3PMS Rated","3PMS Filter");t.innerHTML="",t.appendChild(e)}}}const t=document.querySelector(".switch-label:has(input#filterEVRated) .switch-text");if(t){const e=createFilterTooltip("EV Rated","EV Rated Filter");t.innerHTML="",t.appendChild(e)}else{const e=document.getElementById("filterEVRated");if(e){const t=e.parentElement.querySelector(".switch-text");if(t){const e=createFilterTooltip("EV Rated","EV Rated Filter");t.innerHTML="",t.appendChild(e)}}}const n=document.querySelector(".switch-label:has(input#filterStudded) .switch-text");if(n){const e=createFilterTooltip("Studded Available","Studded Available Filter");n.innerHTML="",n.appendChild(e)}else{const e=document.getElementById("filterStudded");if(e){const t=e.parentElement.querySelector(".switch-text");if(t){const e=createFilterTooltip("Studded Available","Studded Available Filter");t.innerHTML="",t.appendChild(e)}}}},100),document.addEventListener("click",e=>{const t=e.target.closest(".info-tooltip-trigger");if(t){e.preventDefault(),e.stopPropagation();showTooltipModal(t.dataset.tooltipKey,t)}});const e=getDOMElement("sortBy");e&&e.addEventListener("input",filterAndRender);const t=getDOMElement("toggleFilters"),n=getDOMElement("mobileFilterContent");t&&n&&(t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","mobileFilterContent"),t.addEventListener("click",()=>{const e=n.classList.toggle("open");t.textContent=e?"Hide Filters":"Show Filters",t.setAttribute("aria-expanded",e?"true":"false")}));const r=getDOMElement("wheelDrawerTrigger"),a=getDOMElement("wheelDrawer");r&&a&&(r.setAttribute("aria-expanded","false"),r.setAttribute("aria-controls","wheelDrawer"),r.addEventListener("click",()=>{const e="block"!==a.style.display;a.style.display=e?"block":"none",r.setAttribute("aria-expanded",e?"true":"false")})),initializeRatingSystem()});