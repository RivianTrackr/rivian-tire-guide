function rtgColor(t){return getComputedStyle(document.documentElement).getPropertyValue("--rtg-"+t).trim()}function escapeHTML(t){return RTG_SHARED.escapeHTML(t)}function rtgIcon(t,a,i){return RTG_SHARED.icon(t,a,i)}function safeImageURL(t){return RTG_SHARED.safeImageURL(t)}function safeLinkURL(t){return RTG_SHARED.safeLinkURL(t)}function safeReviewLinkURL(t){return RTG_SHARED.safeReviewLinkURL(t)}function getCompareIndexes(){return(new URLSearchParams(window.location.search).get("compare")||"").split(",").map(a=>parseInt(a.trim())).filter(a=>!isNaN(a))}function fmtPrice(t){const a=parseFloat(t);return isNaN(a)?"-":"$"+a.toFixed(2)}function fmtWeight(t){const a=parseFloat(t);return isNaN(a)?"-":a+" lb"}function fmtWarranty(t){const a=parseInt(t);return isNaN(a)||a===0?"-":Number(a).toLocaleString()+" mi"}function fmtLoad(t){const a=parseInt(t);return isNaN(a)||a===0?"-":Number(a).toLocaleString()+" lb"}const COL={tireId:0,size:1,diameter:2,brand:3,model:4,category:5,price:6,warranty:7,weight:8,threePms:9,tread:10,loadIndex:11,maxLoad:12,loadRange:13,speedRating:14,psi:15,utqg:16,tags:17,link:18,image:19,effScore:20,effGrade:21,reviewLink:22},GRADE_COLORS={A:"#5ec095",B:"#a3e635",C:"#facc15",D:"#f97316",F:"#b91c1c"};function findBestValues(t){const a={},i=e=>t.map(s=>parseFloat(s[e])).filter(s=>!isNaN(s)&&s>0),r=i(COL.price);r.length>1&&(a.price=Math.min(...r));const n=i(COL.weight);n.length>1&&(a.weight=Math.min(...n));const o=t.map(e=>parseInt(e[COL.warranty])).filter(e=>!isNaN(e)&&e>0);o.length>1&&(a.warranty=Math.max(...o));const c=t.map(e=>parseInt(e[COL.effScore])).filter(e=>!isNaN(e)&&e>0);return c.length>1&&(a.effScore=Math.max(...c)),a}function effBadge(t,a){const i=escapeHTML(t||"-"),r=escapeHTML((a||"-").toUpperCase());return`<span class="cmp-eff-badge">
    <span class="cmp-eff-grade" style="background:${GRADE_COLORS[r]||"#94a3b8"}">${r}</span>
    <span class="cmp-eff-score">${i}/100</span>
  </span>`}function renderTags(t){if(!t||t==="-")return"-";const a=t.split(/[,|]/).map(i=>i.trim()).filter(Boolean);return a.length?`<div class="cmp-tags">${a.map(i=>{const r=i.toLowerCase();let n="cmp-tag";return r.includes("ev rated")?n+=" cmp-tag-ev":r.includes("3pms")||r.includes("3-peak")?n+=" cmp-tag-3pms":r.includes("studded")&&(n+=" cmp-tag-studded"),`<span class="${n}">${escapeHTML(i)}</span>`}).join("")}</div>`:"-"}function renderCTAs(t){const a=safeLinkURL(t[COL.link]),i=safeReviewLinkURL(t[COL.reviewLink]);if(!a&&!i)return"-";let r='<div class="cmp-cta-wrap">';if(a&&(r+=`<a href="${escapeHTML(a)}" target="_blank" rel="noopener noreferrer" class="cmp-cta cmp-cta-primary">
      View Tire ${rtgIcon("arrow-up-right",14)}</a>`),i){let n=!1;try{const s=new URL(i,window.location&&window.location.origin?window.location.origin:void 0).hostname.toLowerCase();n=s==="youtube.com"||s==="www.youtube.com"||s.endsWith(".youtube.com")||s==="youtu.be"||s==="www.youtu.be"||s==="tiktok.com"||s==="www.tiktok.com"||s.endsWith(".tiktok.com")}catch{n=!1}const o=n?"circle-play":"newspaper",c=n?"Watch Official Review":"Read Official Review";r+=`<a href="${escapeHTML(i)}" target="_blank" rel="noopener noreferrer" class="cmp-cta cmp-cta-review">
      ${c} ${rtgIcon(o,14)}</a>`}return r+="</div>",r}function specSection(t,a,i,r,n,o){let c="";return i.forEach(([e,s,l])=>{const p=r.map(m=>{const d=s(m);return`<div class="cmp-row-value${l&&n[l]!==void 0&&parseFloat(d)===n[l]?" is-best":""}">${typeof d=="string"&&d.startsWith("<")?d:escapeHTML(d||"-")}</div>`});c+=`<div class="cmp-row">
      <div class="cmp-row-label">${escapeHTML(e)}</div>
      <div class="cmp-row-values" style="--cmp-cols:${o}">${p.join("")}</div>
    </div>`}),`<div class="cmp-section">
    <div class="cmp-section-header" onclick="this.parentElement.classList.toggle('collapsed')">
      ${rtgIcon(t,16,"cmp-section-icon")}
      <span class="cmp-section-title">${escapeHTML(a)}</span>
      ${rtgIcon("chevron-down",14,"cmp-section-chevron")}
    </div>
    <div class="cmp-section-body">${c}</div>
  </div>`}function renderComparison(t,a){const i=a.map(e=>t[e]).filter(Boolean),r=document.getElementById("comparisonContent");if(!i.length)return;const n=findBestValues(i),o=i.length;let c=`<div class="cmp-tire-headers" style="--cmp-cols:${o}">`;i.forEach(e=>{const s=safeImageURL(e[COL.image]),l=e[COL.diameter]||"",p=l&&!l.includes('"')?l+'"':l;c+=`<div class="cmp-tire-header">
      <div class="cmp-tire-img-wrap">
        ${s?`<img src="${escapeHTML(s)}" alt="${escapeHTML(e[COL.brand]+" "+e[COL.model])}" loading="lazy" />`:rtgIcon("image",32,"cmp-placeholder-icon")}
      </div>
      <div class="cmp-tire-info">
        <div class="cmp-tire-brand">${escapeHTML(e[COL.brand])}</div>
        <div class="cmp-tire-model">${escapeHTML(e[COL.model])}</div>
        <div class="cmp-tire-size">${escapeHTML(e[COL.size])} &middot; ${escapeHTML(p)} &middot; ${escapeHTML(e[COL.category])}</div>
        <div class="cmp-tire-meta">
          <div class="cmp-tire-meta-item">
            <span class="cmp-tire-meta-label">Price</span>
            <span class="cmp-tire-meta-value">${fmtPrice(e[COL.price])}</span>
          </div>
          <div class="cmp-tire-meta-item">
            <span class="cmp-tire-meta-label">Weight</span>
            <span class="cmp-tire-meta-value">${fmtWeight(e[COL.weight])}</span>
          </div>
          <div class="cmp-tire-meta-item">
            <span class="cmp-tire-meta-label">Efficiency</span>
            <span class="cmp-tire-meta-value">${effBadge(e[COL.effScore],e[COL.effGrade])}</span>
          </div>
        </div>
      </div>
    </div>`}),c+="</div>",c=`<p class="cmp-subtitle">Comparing ${o} tire${o!==1?"s":""} side by side. Best values are <span style="color:var(--rtg-accent);font-weight:600">highlighted</span>.</p>`+c,c+=specSection("dollar-sign","Price & Value",[["Price",e=>fmtPrice(e[COL.price]),"price"],["Mileage Warranty",e=>fmtWarranty(e[COL.warranty]),"warranty"],["Category",e=>e[COL.category]||"-"]],i,n,o),c+=specSection("gauge-high","Performance",[["Efficiency",e=>effBadge(e[COL.effScore],e[COL.effGrade]),"effScore"],["Speed Rating",e=>e[COL.speedRating]||"-"],["UTQG",e=>e[COL.utqg]||"None"],["3PMS Rated",e=>(e[COL.threePms]||"").toLowerCase()==="yes"?'<span style="color:var(--rtg-accent);font-weight:600">'+rtgIcon("check",14)+" Yes</span>":"No"]],i,n,o),c+=specSection("weight-hanging","Size & Weight",[["Tire Size",e=>e[COL.size]||"-"],["Rim Diameter",e=>{const s=e[COL.diameter]||"-";return s!=="-"&&!s.includes('"')?s+'"':s}],["Weight",e=>fmtWeight(e[COL.weight]),"weight"],["Tread Depth",e=>e[COL.tread]||"-"]],i,n,o),c+=specSection("truck","Load & Pressure",[["Load Index",e=>e[COL.loadIndex]||"-"],["Max Load",e=>fmtLoad(e[COL.maxLoad])],["Load Range",e=>e[COL.loadRange]||"-"],["Max PSI",e=>{const s=e[COL.psi];return s&&s!=="-"?s+" psi":"-"}]],i,n,o),c+=specSection("tags","Tags & Features",[["Tags",e=>renderTags(e[COL.tags])]],i,n,o),c+=specSection("cart-shopping","Where to Buy",[["Links",e=>renderCTAs(e)]],i,n,o),r.innerHTML=c}function initShareButton(){const t=document.getElementById("shareBtn");t&&t.addEventListener("click",()=>{const a=window.location.href;function i(){const r=t.querySelector("i"),n=t.querySelector("span"),o=r?r.outerHTML:"",c=n?n.textContent:"";r&&(r.outerHTML=rtgIcon("check",16)),n&&(n.textContent="Copied!"),setTimeout(()=>{const e=t.querySelector("i");e&&(e.outerHTML=o),n&&(n.textContent=c)},2e3)}navigator.share?navigator.share({title:"Rivian Tire Comparison",url:a}).catch(()=>{}):navigator.clipboard&&navigator.clipboard.writeText(a).then(i)})}document.addEventListener("DOMContentLoaded",()=>{const t=getCompareIndexes();initShareButton(),t.length&&(typeof rtgData<"u"&&rtgData.tires&&Array.isArray(rtgData.tires)?renderComparison(rtgData.tires,t):document.getElementById("comparisonContent").innerHTML='<div class="cmp-empty"><div class="cmp-empty-icon">'+rtgIcon("triangle-exclamation",48)+'</div><div class="cmp-empty-title">Data unavailable</div><div class="cmp-empty-text">Tire data could not be loaded.</div></div>')});
