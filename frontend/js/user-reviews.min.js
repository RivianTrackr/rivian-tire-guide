(function(){"use strict";function u(e,t,r){var n="fa-solid",a="fa-"+e;e==="heart-outline"?(n="fa-regular",a="fa-heart"):e==="arrow-up-right"?a="fa-up-right-from-square":e==="trash"?a="fa-trash-can":e==="share"&&(a="fa-share-nodes");var i=n+" "+a;r&&(i+=" "+r);var s=t?' style="font-size:'+t+'px"':"";return'<i class="'+i+'"'+s+' aria-hidden="true"></i>'}var l=typeof rtgUserReviews<"u"&&rtgUserReviews.tireGuideUrl||"",w=document.getElementById("rtg-user-reviews-back");if(w&&l){var o=document.createElement("a");o.href=l,o.className="rtg-user-reviews-back-link",o.innerHTML=u("arrow-left",14)+" Back to Tire Guide",w.appendChild(o)}const y=new URLSearchParams(window.location.search),h=parseInt(y.get("reviewer"),10);if(!h){const e=document.getElementById("rtg-user-reviews-list");e&&(e.innerHTML='<div class="rtg-reviews-empty"><div class="rtg-reviews-empty-heading">No reviewer specified</div></div>');return}m(1);function m(e){const t=document.getElementById("rtg-user-reviews-list");if(!t)return;t.innerHTML='<div class="rtg-reviews-loading">Loading reviews...</div>';const r=new FormData;r.append("action","rtg_get_user_reviews"),r.append("user_id",h),r.append("page",e),rtgUserReviews.nonce&&r.append("nonce",rtgUserReviews.nonce),fetch(rtgUserReviews.ajaxurl,{method:"POST",body:r}).then(function(n){return n.json()}).then(function(n){if(!n.success){t.innerHTML='<div class="rtg-reviews-empty"><div class="rtg-reviews-empty-heading">Could not load reviews</div></div>';return}var a=n.data,i=document.getElementById("rtg-user-reviews-title");i&&(i.textContent="Reviews by "+a.display_name);var s=document.getElementById("rtg-user-reviews-count");if(s&&(s.textContent=a.total+" review"+(a.total!==1?"s":"")),!a.reviews||!a.reviews.length){t.innerHTML='<div class="rtg-reviews-empty"><div class="rtg-reviews-empty-icon">✍️</div><div class="rtg-reviews-empty-heading">No reviews yet</div></div>';return}t.innerHTML="",a.reviews.forEach(function(c){t.appendChild(C(c))}),M(a.page,a.total_pages)}).catch(function(){t.innerHTML='<div class="rtg-reviews-empty"><div class="rtg-reviews-empty-heading">Failed to load reviews</div></div>'})}function E(e){if(!l||!e.tire_id)return"";var t=new URL(l);return t.searchParams.set("tire",e.tire_id),t.toString()}function C(e){var t=document.createElement("div");t.className="rtg-review-card rtg-user-review-card";var r=document.createElement("div");r.className="rtg-user-review-tire";var n=E(e);if(e.image){var a=document.createElement("img");a.src=e.image,a.alt=(e.brand||"")+" "+(e.model||""),a.className="rtg-user-review-tire-img",a.loading="lazy",r.appendChild(a)}var i=(e.brand||"")+" "+(e.model||"");if(n){var s=document.createElement("a");s.href=n,s.className="rtg-user-review-tire-name rtg-user-review-tire-link",s.textContent=i,r.appendChild(s)}else{var c=document.createElement("span");c.className="rtg-user-review-tire-name",c.textContent=i,r.appendChild(c)}t.appendChild(r);var v=document.createElement("div");v.className="rtg-review-card-header";var f=document.createElement("span");f.className="rtg-review-card-stars",f.innerHTML=N(e.rating),v.appendChild(f);var g=document.createElement("span");if(g.className="rtg-review-date",g.textContent=T(e.updated_at||e.created_at),v.appendChild(g),t.appendChild(v),e.review_title){if(n){var d=document.createElement("a");d.href=n,d.className="rtg-review-card-title rtg-review-card-title-link",d.textContent=e.review_title}else{var d=document.createElement("div");d.className="rtg-review-card-title",d.textContent=e.review_title}t.appendChild(d)}var p=document.createElement("div");return p.className="rtg-review-card-body",p.textContent=e.review_text,t.appendChild(p),t}function N(e){for(var t=Math.round(e),r="",n=1;n<=5;n++)r+='<span class="rtg-mini-star'+(n<=t?" filled":"")+'">★</span>';return r}function T(e){if(!e)return"";var t=e.indexOf("T")===-1&&e.indexOf("Z")===-1?e.replace(" ","T")+"Z":e,r=new Date(t);if(isNaN(r.getTime()))return e;var n=new Date,a=n-r,i=Math.floor(a/864e5);return i===0?"Today":i===1?"Yesterday":i<7?i+" days ago":r.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function M(e,t){var r=document.getElementById("rtg-user-reviews-pagination");if(r&&(r.innerHTML="",!(t<=1))){if(e>1){var n=document.createElement("button");n.className="rtg-pagination-btn",n.innerHTML=u("chevron-left",14)+" Previous",n.addEventListener("click",function(){m(e-1)}),r.appendChild(n)}var a=document.createElement("span");if(a.className="rtg-pagination-info",a.textContent="Page "+e+" of "+t,r.appendChild(a),e<t){var i=document.createElement("button");i.className="rtg-pagination-btn",i.innerHTML="Next "+u("chevron-right",14),i.addEventListener("click",function(){m(e+1)}),r.appendChild(i)}}}})();
